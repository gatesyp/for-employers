!function(n,i){"use strict";window.dh_notifier=new function(){var i=this,t="/notifier/",e=!1,a=[],o={};this.reload=function(){e=!1,this.headlines()},this.headlines=function(i){var a=this,s=n.Deferred();if(e)s.resolve(a);else{n.ajax({url:t+"headlines",cache:!1}).done(function(n){if(e=!0,n.data)for(var i in n.data){a[i]=n.data[i];var t=i.slice(0,-1);o[t]&&(o[t].rendered=!1,a.refreshCount(t))}s.resolve(a)}).fail(function(){});var r=o.notification;if(r){var c=r.count<=0?"None":r.count;n.log_event("notification_bell_click",{"new-item-present":c})}}return i&&s.done(i),s},this.inject=function(n,t){return e=!0,o[n].rendered=!1,i[n+"s"]=t,i.render(n),i.refreshCount(n),i},this.render=function(e){var a=e+"s",s=e+"_id",r=o[e];if(!r.rendered)return i.headlines(function(i){r.$loader.hide(),r.$list.find("li").not(".notification-loading").remove(),"notifications"===a&&0===i[a].length&&i[a].push({notification_type:"no notifications",quiz_url:"javascript:void(0);"});for(var o=0;o<i[a].length;o++){var c,d=i[a][o];if("announcements"===a)c=n('<li class="'+e+'"><div class="headline"><span class="title">'+d.title+'</span> <span class="summary">'+d.summary+"</span></div>"+(d.content_slim?'<div class="announcementContent"><div class="content-slim">'+d.content_slim+"</div></div>":"")+"</li>");else if("notifications"===a){var u,l="Add a Reference",f="/candidate/suggested-jobs?add_references=1",h=d.job_title+", "+d.hiring_company_name;"application_viewed"===d.notification_type?u="Application viewed!":"resume_thumbs_up"===d.notification_type?u="You were given a thumbs up!":"no notifications"===d.notification_type&&(u="You are up to date","suggested-jobs"!==window.location.href.split("/").pop()&&(l="View Suggested Jobs",f="/candidate/suggested-jobs"),h="Check back later!"),c=n('<li class="'+e+'"><div class="headline"><span class="title'+(d.unread?" unread":"")+'">'+u+'</span><br /> <span class="summary"><a href="'+d.quiz_url+'">'+h+'</a></span><br /> <a href="'+f+'" class="btnPrompt">'+l+"</a></div></li>")}c.data(e,o).appendTo(r.$list),c.on("touchstart",function(i){var t=n(this);return!!t.hasClass("expand")||(t.addClass("expand"),i.preventDefault(),!1)}).on("click",function(o){var r=n(this).data(e),c=i[a][r];(c.cta_url||c.has_content)&&(window.open(t+e+"/view/"+c[s]),o.preventDefault())}).hover(function(t){var o=n(this);o.data("timer-disp",setTimeout(function(){o.addClass("expand");var n=i[a][o.data(e)];i.markRead(e,n)},500))},function(n){})}}).then(function(){r.rendered=!0,i.markAllRead(e)}),i},this.hide=function(n){return o[n].$group.removeClass("expand").find("li").removeClass("expand"),this},this.show=function(n){return o[n].$group.addClass("expand"),this},this.markAllRead=function(i){var e,a=this,s=i+"s";a.notifications&&1===a.notifications.length&&"no notifications"===a.notifications[0].notification_type||(e=a.notifications?{url:t+i+"/markallread",cache:!1,method:"POST",data:JSON.stringify(a.notifications),dataType:"json",contentType:"application/json"}:{url:t+i+"/markallread",cache:!1},n.ajax(e).done(function(n){if(n.success){o[i];for(var t=a[s].length;t-- >0;)a[s][t].unread=0;a.refreshCount(i)}else console.log(n.message)}).fail(function(n){console.log(n.message)}))},this.markRead=function(i,e){var a=this,o=i+"_id";e&&1*e.unread&&n.ajax({url:t+i+"/markread/"+e[o],cache:!1}).done(function(n){n.success?(e[unread]=0,a.refreshCount(i)):console.log(n.message)}).fail(function(n){console.log(n.message)})},this.refreshCount=function(n){for(var t=n+"s",e=o[n],a=i[t].length,s=0,r=a;r-- >0;)1*i[t][r].unread&&s++;return e.$count.text(s),e.total=a,e.unread=s,a&&(s?(e.$indicator.show(),e.$count.show()):e.$count.hide()),i},n(function(){n(".notifier").each(function(){var t=n(this),e=t.data("notification-type");void 0===i[e+"s"]&&(i[e+"s"]=[]),i[e+"s"].push({unread:1}),a.push(e);var s=o[e]={type:e,$group:t};s.$indicator=s.$group.find(".notification-indicator"),s.$dropdown=s.$group.find(".notification-container"),s.$count=s.$group.find(".notification-count"),s.$loader=s.$group.find(".notification-loading"),s.$list=s.$dropdown.find(".notification-list-inner"),s.count=1*s.$count.text(),t.hover(function(t){n(".dropdown").removeClass("open");var a=s.$group.data("timer");a&&clearTimeout(a),i.show(e),i.render(e)},function(n){t.data("timer",setTimeout(function(){i.hide(e)},500))}),s.$indicator.click(function(n){s.$group.toggleClass("expand")})})})}}(window.jQuery);
